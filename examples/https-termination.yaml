# HTTPS Termination Configuration
# TLS termination at the proxy with HTTP backend

listeners:
  # HTTPS listener with TLS
  - address: "0.0.0.0:443"
    protocol: https
    tls:
      cert: "/etc/prism/certs/server.crt"
      key: "/etc/prism/certs/server.key"
      min_version: "1.2"
      alpn:
        - "h2"
        - "http/1.1"

  # Optional HTTP redirect to HTTPS
  - address: "0.0.0.0:80"
    protocol: http

upstreams:
  backend:
    servers:
      - address: "127.0.0.1:3000"
    connect_timeout: 5s
    request_timeout: 30s

routes:
  # Redirect HTTP to HTTPS
  - match:
      path_prefix: "/"
    handler:
      type: redirect
      redirect_url: "https://example.com"
    priority: 100

  # Main HTTPS route
  - match:
      path_prefix: "/"
    upstream: backend
    priority: 0

global:
  http2: true
  max_body_size: 10485760  # 10MB
  shutdown_timeout: 30s
