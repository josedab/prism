# Load Balancing Configuration
# Multiple backends with health checks and circuit breakers

listeners:
  - address: "0.0.0.0:8080"
    protocol: http
    max_connections: 10000

upstreams:
  # Primary application servers
  app_servers:
    servers:
      - address: "10.0.1.1:8080"
        weight: 3
      - address: "10.0.1.2:8080"
        weight: 2
      - address: "10.0.1.3:8080"
        weight: 1
    load_balancing: weighted
    health_check:
      check_type: http
      path: "/health"
      expected_status: 200
      interval: 10s
      timeout: 5s
      unhealthy_threshold: 3
      healthy_threshold: 2
    circuit_breaker:
      failure_threshold: 5
      success_threshold: 3
      half_open_timeout: 30s
    retry:
      max_retries: 3
      retry_on: [502, 503, 504]
      initial_delay: 100ms
      max_delay: 5s
    pool:
      max_connections: 100
      min_idle: 10
      max_lifetime: 1h
      idle_timeout: 60s

  # Backup servers (failover)
  backup_servers:
    servers:
      - address: "10.0.2.1:8080"
    load_balancing: round_robin
    health_check:
      check_type: tcp
      interval: 5s
      timeout: 2s

routes:
  - match:
      path_prefix: "/"
    upstream: app_servers

observability:
  metrics:
    enabled: true
    per_route: true
  access_log:
    enabled: true
    format: json

admin:
  address: "127.0.0.1:9090"
  auth_enabled: true
  api_key: "your-secure-api-key"
